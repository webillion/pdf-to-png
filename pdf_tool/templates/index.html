<!DOCTYPE html>
<html lang="ja">
<head>
       <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MTB190WE2E"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-MTB190WE2E');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Material Studio Pro</title>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --accent: #38bdf8; --text: #f8fafc; --dim: #94a3b8; }
        body { background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 20px; }
        .app { background: var(--card); width: 100%; max-width: 480px; padding: 2.5rem; border-radius: 2rem; border: 1px solid #334155; text-align: center; box-shadow: 0 25px 50px rgba(0,0,0,0.5); }
        .usage-info { background: rgba(15, 23, 42, 0.6); color: var(--accent); padding: 6px 16px; border-radius: 99px; font-size: 0.8rem; font-weight: bold; margin-bottom: 2rem; display: inline-block; }
        
        /* ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³ */
        .drop-zone { border: 2px dashed #475569; border-radius: 1rem; padding: 3rem 1rem; cursor: pointer; transition: 0.3s; background: rgba(15, 23, 42, 0.2); position: relative; }
        .drop-zone:hover, .drop-zone.dragging { border-color: var(--accent); background: rgba(56, 189, 248, 0.05); }
        .drop-zone p { margin: 0; color: var(--dim); }
        
        /* ãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆè¡¨ç¤º */
        #file-list { margin-top: 1.5rem; text-align: left; max-height: 120px; overflow-y: auto; background: #0f172a; border-radius: 0.5rem; padding: 0.5rem; display: none; }
        .file-name { font-size: 0.85rem; padding: 4px 8px; border-bottom: 1px solid #1e293b; color: var(--accent); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        
        .field-label { display: block; text-align: left; font-size: 0.75rem; color: var(--dim); margin: 1rem 0 0.4rem 0; text-transform: uppercase; }
        .input-field { width: 100%; background: #0f172a; border: 1px solid #334155; padding: 0.8rem; border-radius: 0.75rem; color: white; box-sizing: border-box; }
        .input-field:focus { outline: none; border-color: var(--accent); }

        button { width: 100%; padding: 1.1rem; border-radius: 1rem; border: none; background: var(--accent); color: #0f172a; font-weight: 800; font-size: 1.1rem; cursor: pointer; margin-top: 1.5rem; transition: 0.3s; }
        button:disabled { background: #475569; color: var(--dim); cursor: not-allowed; }
        
        #msg-box { display: none; padding: 1rem; border-radius: 0.8rem; margin-bottom: 1.5rem; font-size: 0.9rem; line-height: 1.5; text-align: left; }
        .err { background: rgba(244, 63, 94, 0.15); color: #f43f5e; border: 1px solid #f43f5e; }
        .ok { background: rgba(16, 185, 129, 0.15); color: #10b981; border: 1px solid #10b981; }

        .loader { display: none; width: 24px; height: 24px; border: 3px solid #334155; border-top: 3px solid var(--accent); border-radius: 50%; animation: spin 0.8s linear infinite; margin: 15px auto; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div class="app">
    <div id="usage-badge" class="usage-info">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å–å¾—ä¸­...</div>
    <h1 style="margin:0; font-size:1.6rem; color:var(--accent);">Material Studio Pro</h1>
    <p style="color:var(--dim); font-size:0.85rem; margin-bottom:2rem;">300DPIé«˜ç”»è³ªãƒ»èƒŒæ™¯é€éPDFå¤‰æ›</p>

    <div id="msg-box"></div>

    <form id="upload-form">
        <label class="field-label">èªè¨¼ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼‰</label>
        <input type="password" id="password" class="input-field" placeholder="Proãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§åˆ¶é™ã‚’è§£é™¤">

        <label class="field-label">PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ </label>
        <div class="drop-zone" id="drop-zone">
            <p id="drop-text"><strong>ã“ã“ã«ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—</strong><br>ã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</p>
            <div id="file-list"></div>
            <input type="file" id="file-input" accept=".pdf" multiple style="display: none;">
        </div>

        <div style="display: flex; gap: 15px; margin-top: 1.5rem; align-items: center;">
            <div style="flex:1;">
                <label class="field-label">å‡ºåŠ›è§£åƒåº¦</label>
                <select id="dpi" class="input-field">
                    <option value="150">150 DPI</option>
                    <option value="300" selected>300 DPI</option>
                </select>
            </div>
            <div style="flex:1; padding-top: 20px;">
                <label style="cursor:pointer; font-size:0.85rem; display:flex; align-items:center; gap:8px;">
                    <input type="checkbox" id="transparent" checked style="width:1.2rem; height:1.2rem;"> é€éæœ‰åŠ¹
                </label>
            </div>
        </div>

        <button type="submit" id="submit-btn">å¤‰æ›ã‚’é–‹å§‹ã™ã‚‹</button>
        <div class="loader" id="loader"></div>
    </form>
</div>

<script>
    const form = document.getElementById('upload-form');
    const fileInput = document.getElementById('file-input');
    const dropZone = document.getElementById('drop-zone');
    const fileList = document.getElementById('file-list');
    const dropText = document.getElementById('drop-text');
    const submitBtn = document.getElementById('submit-btn');
    const msgBox = document.getElementById('msg-box');
    const usageBadge = document.getElementById('usage-badge');

    // å›æ•°å–å¾—
    async function refreshStatus() {
        const res = await fetch('/status');
        const data = await res.json();
        usageBadge.innerText = `æœ¬æ—¥ã®æ®‹ã‚Š: ${Math.max(0, data.limit - data.count)} / ${data.limit} å›`;
    }
    refreshStatus();

    // ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—
    dropZone.onclick = () => fileInput.click();
    dropZone.ondragover = (e) => { e.preventDefault(); dropZone.classList.add('dragging'); };
    dropZone.ondragleave = () => dropZone.classList.remove('dragging');
    dropZone.ondrop = (e) => {
        e.preventDefault();
        dropZone.classList.remove('dragging');
        fileInput.files = e.dataTransfer.files;
        updateFileList();
    };
    fileInput.onchange = updateFileList;

    function updateFileList() {
        if (fileInput.files.length > 0) {
            dropText.style.display = 'none';
            fileList.style.display = 'block';
            fileList.innerHTML = Array.from(fileInput.files)
                .map(f => `<div class="file-name">ğŸ“„ ${f.name}</div>`).join('');
        }
    }

    form.onsubmit = async (e) => {
        e.preventDefault();
        if (fileInput.files.length === 0) return alert("ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„");

        submitBtn.disabled = true;
        submitBtn.innerText = "å¤‰æ›ä¸­...";
        document.getElementById('loader').style.display = 'block';
        msgBox.style.display = 'none';

        const pwd = document.getElementById('password').value;
        const fd = new FormData();
        for (let f of fileInput.files) fd.append('file', f);
        fd.append('password', pwd);
        fd.append('dpi', document.getElementById('dpi').value);
        if (document.getElementById('transparent').checked) fd.append('transparent', 'on');

        try {
            const res = await fetch('/convert', { method: 'POST', body: fd });
            
            if (res.status === 403) {
                const data = await res.json();
                showMsg(data.error, "err");
            } else if (!res.ok) {
                throw new Error("å¤‰æ›ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ•ã‚¡ã‚¤ãƒ«ãŒé‡ã™ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚");
            } else {
                // æˆåŠŸ
                if (pwd === "admin1234" || pwd === "pro_user_77") {
                    showMsg("åˆ¶é™ã‚’è§£é™¤ã—ã¾ã—ãŸã€‚ç„¡åˆ¶é™ã§ä½¿ãˆã¾ã™ã€‚", "ok");
                    usageBadge.innerText = "PRO MODE: ç„¡åˆ¶é™åˆ©ç”¨ä¸­";
                }
                const blob = await res.blob();
                const a = document.createElement('a');
                a.href = window.URL.createObjectURL(blob);
                a.download = `material_pro_${Date.now()}.zip`;
                a.click();
            }
        } catch (err) {
            showMsg(err.message, "err");
        } finally {
            submitBtn.disabled = false;
            submitBtn.innerText = "å¤‰æ›ã‚’é–‹å§‹ã™ã‚‹";
            document.getElementById('loader').style.display = 'none';
            refreshStatus();
        }
    };

    function showMsg(t, c) {
        msgBox.innerText = t;
        msgBox.className = c;
        msgBox.style.display = "block";
    }
</script>
</body>
</html>
